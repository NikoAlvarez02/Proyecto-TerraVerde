{% extends 'base.html' %}
{% load static %}

{% block title %}Reportes | TerraVerde{% endblock %}
{% block topbar_title %}Dashboard de Reportes{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'CSS/reports.css' %}">
{% endblock %}

{% block content %}
  <div class="rp-page">
    <section class="card">
      <div class="rp-actions">
        <button class="btn btn-primary" onclick="location.href='{% url 'reportes:viewer' %}'">Generar Nuevo Reporte</button>
      </div>
    </section>

    <section class="card">
      <h3 class="rp-subtitle">Reportes recientes</h3>
      <ul id="recent-list" class="rp-list"></ul>
    </section>
  </div>

  <script>
    fetch('/reportes/api/generados/?page_size=10', {credentials:'include'})
      .then(r=>r.json()).then(d=>{
        const ul = document.getElementById('recent-list');
        (d.results||[]).forEach(it=>{
          const url = it.archivo_url || it.archivo_pdf;
          const li=document.createElement('li');
          li.innerHTML = `<a href="${url}" target="_blank">${it.tipo} - ${new Date(it.fecha_generacion).toLocaleString()}</a>`;
          ul.appendChild(li);
        });
      });
  </script>
{% endblock %}
