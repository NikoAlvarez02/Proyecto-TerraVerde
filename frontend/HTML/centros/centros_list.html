{% extends "base.html" %}
{% load static %}

{% block title %}Centros | TerraVerde{% endblock %}
{% block topbar_title %}Centros{% endblock %}
{% block sidebar %}{% endblock %}

{% block content %}
  <div class="card" style="padding:20px;">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <h1 class="main-title" style="margin:0;">Centros</h1>
      <div style="display:flex; gap:8px;">
        <a href="/admin/centers/center/" class="btn">Abrir en Admin</a>
        <button id="btnNuevoCentro" class="btn btn-guardar">Nuevo Centro</button>
      </div>
    </div>

    <div style="display:flex; gap:8px; align-items:center; justify-content:flex-end; margin-top:10px;">
      <input id="c_q" type="search" placeholder="Buscar código / nombre / dirección" style="padding:6px 10px; min-width:260px;">
      <select id="c_activo" style="padding:6px 10px;">
        <option value="">Todos</option>
        <option value="true">Solo activos</option>
        <option value="false">Solo inactivos</option>
      </select>
      <select id="c_orden" style="padding:6px 10px;">
        <option value="nombre">Nombre A-Z</option>
        <option value="-nombre">Nombre Z-A</option>
        <option value="codigo">Código A-Z</option>
        <option value="-codigo">Código Z-A</option>
      </select>
      <button id="c_buscar" class="btn">Filtrar</button>
    </div>

    <div class="tabla-wrap" style="margin-top:12px;">
      <table class="tabla-listado" id="centros-table">
        <thead>
          <tr>
            <th>Código</th>
            <th>Nombre</th>
            <th>Dirección</th>
            <th>Activo</th>
            <th style="width:1%; white-space:nowrap;"></th>
          </tr>
        </thead>
        <tbody id="tbody">
          <tr><td colspan="5">Cargando...</td></tr>
        </tbody>
      </table>
    </div>

    <div id="flash" style="display:none;margin-top:10px;"></div>
  </div>

  <!-- Modal Crear/Editar Centro -->
  <div id="modalCentro" class="modal">
    <div class="card modal-card">
      <div class="modal-header drag-handle">
        <div class="title-wrap">
          <h2 id="modalTitle" class="main-title" style="color:#fff;">Nuevo Centro</h2>
          <p>Completa los datos principales del centro.</p>
        </div>
        <button id="btnCerrarCentro" class="modal-close" aria-label="Cerrar modal">✕</button>
      </div>
      <div class="modal-body">
        <form id="formCentro" class="grid-2">
          {% csrf_token %}
          <input type="hidden" id="c_id">

          <div>
            <label>Código</label>
            <input type="text" id="c_codigo" required>
          </div>
          <div>
            <label>Nombre</label>
            <input type="text" id="c_nombre" required>
          </div>
          <div class="col-span-2">
            <label>Dirección</label>
            <input type="text" id="c_direccion" required>
          </div>
          <div>
            <label>Teléfono</label>
            <input type="text" id="c_telefono">
          </div>
          <div>
            <label>Email</label>
            <input type="email" id="c_email">
          </div>
          <div class="col-span-2">
            <label style="display:flex; align-items:center; gap:8px;">
              <input type="checkbox" id="c_activo_chk" checked> Activo
            </label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <div class="footer-left"></div>
        <div class="footer-actions">
          <button type="button" id="btnCancelarCentro" class="btn btn-secondary">Cancelar</button>
          <button type="submit" form="formCentro" class="btn btn-success">Guardar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmación Eliminación -->
  <div id="modalConfirm" class="modal">
    <div class="card modal-card" style="max-width:520px;">
      <div class="modal-header">
        <div class="title-wrap">
          <h2 style="margin:0; color:#fff;">Confirmar eliminación</h2>
          <p>Esta acción no se puede deshacer.</p>
        </div>
        <button class="modal-close" type="button" aria-label="Cerrar" onclick="document.getElementById('btnNo')?.click();">✕</button>
      </div>
      <div class="modal-body">
        <p>¿Seguro que querés eliminar este centro?</p>
      </div>
      <div class="modal-footer">
        <div class="footer-left">
          <button id="btnNo" type="button" class="btn btn-secondary">Cancelar</button>
        </div>
        <div class="footer-actions">
          <button id="btnSi" class="btn btn-danger">Eliminar</button>
        </div>
      </div>
    </div>
  </div>

  {% block extra_js %}
  <script src="{% static 'JS/centros/spa.js' %}"></script>
  {% endblock %}
{% endblock %}
