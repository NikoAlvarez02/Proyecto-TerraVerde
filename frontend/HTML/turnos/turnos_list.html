{% extends "base.html" %}
{% load static %}

{% block title %}Turnos | TerraVerde{% endblock %}
{% block topbar_title %}Turnos{% endblock %}
{% block sidebar %}{% endblock %}

{% block content %}
<div class="main-wrap" style="display:flex; gap:24px;">
  <section class="contenido-principal" style="flex:1;">
    <div class="card" style="padding:20px;">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:16px;">
        <h1 class="main-title" style="margin:0;">Listado de Turnos</h1>
        <button id="btnNuevo" class="btn btn-guardar">Nuevo Turno</button>
      </div>

      <div style="display:flex; gap:8px; align-items:center; justify-content:flex-end; margin-top:8px; flex-wrap:wrap;">
        <input id="t_q" type="search" placeholder="Buscar paciente/profesional/motivo" style="padding:6px 10px; min-width:240px;" />
        <select id="t_pac" style="padding:6px 10px; min-width:180px;"><option value="">Paciente (todos)</option></select>
        <select id="t_prof" style="padding:6px 10px; min-width:180px;"><option value="">Profesional (todos)</option></select>
        <input id="t_desde" type="date" style="padding:6px 10px;" />
        <input id="t_hasta" type="date" style="padding:6px 10px;" />
        <select id="t_estado" style="padding:6px 10px;">
          <option value="">Todos</option>
          <option value="pendiente">Pendiente</option>
          <option value="confirmado">Confirmado</option>
          <option value="cancelado">Cancelado</option>
          <option value="atendido">Atendido</option>
          <option value="ausente">Ausente</option>
        </select>
        <select id="t_orden" style="padding:6px 10px;">
          <option value="-fecha_hora">Más recientes</option>
          <option value="fecha_hora">Más antiguos</option>
        </select>
        <div style="display:flex; gap:6px; align-items:center;">
          <button id="t_hoy" class="btn">Hoy</button>
          <button id="t_semana" class="btn">Semana</button>
          <button id="t_mes" class="btn">Mes</button>
        </div>
        <button id="t_buscar" class="btn">Filtrar</button>
        <button id="t_limpiar" class="btn btn-secundario">Limpiar</button>
      </div>

      <div style="overflow:auto; margin-top:10px;">
        <table class="tabla-listado">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Hora</th>
              <th>Paciente</th>
              <th>Profesional</th>
              <th>Estado</th>
              <th style="width:1%; white-space:nowrap;"></th>
            </tr>
          </thead>
          <tbody id="turnos-tbody">
            <tr><td colspan="6">Cargando...</td></tr>
          </tbody>
        </table>
      </div>

      <div style="display:flex; gap:10px; align-items:center; justify-content:flex-end; margin-top:10px;">
        <button id="t_prev" class="btn">Anterior</button>
        <span id="t_pageInfo" style="color:#666;"></span>
        <button id="t_next" class="btn">Siguiente</button>
      </div>

      <div id="flash" style="margin-top:12px; display:none;"></div>
    </div>
  </section>
</div>

<!-- Modal Crear/Editar -->
<div id="modalForm" class="modal">
  <div class="card" style="max-width:720px; width:95%; background:#fff; border-radius:12px; padding:16px; margin:0;">
    <div class="drag-handle" style="display:flex; justify-content:space-between; align-items:center;">
      <h2 id="modalTitle" class="main-title" style="margin:0;">Nuevo Turno</h2>
      <button id="btnCerrarModal" class="btn btn-secundario">Cerrar</button>
    </div>

    <form id="formTurno" style="margin-top:12px;">
      {% csrf_token %}
      <input type="hidden" id="turnoId">

      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
        <div>
          <label>Fecha</label>
          <input type="date" id="fecha" name="fecha" required>
        </div>
        <div>
          <label>Hora</label>
          <input type="time" id="hora" name="hora" required>
        </div>
        <div>
          <label>Paciente</label>
          <select id="paciente" name="paciente" required>
            <option value="">Cargando...</option>
          </select>
        </div>
        <div>
          <label>Profesional</label>
          <select id="profesional" name="profesional" required>
            <option value="">Cargando...</option>
          </select>
        </div>
        <div>
          <label>Estado</label>
          <select id="estado" name="estado" required>
            <option value="pendiente">Pendiente</option>
            <option value="confirmado">Confirmado</option>
            <option value="cancelado">Cancelado</option>
          </select>
        </div>
        <div style="grid-column:1 / -1;">
          <label>Motivo</label>
          <input type="text" id="motivo" name="motivo" placeholder="Opcional">
        </div>
        <div style="grid-column:1 / -1;">
          <label>Observaciones</label>
          <textarea id="observaciones" name="observaciones" rows="3" placeholder="Opcional"></textarea>
        </div>
      </div>

      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
        <button type="button" id="btnCancelar" class="btn btn-cancelar-edit">Cancelar</button>
        <button type="submit" class="btn btn-guardar">Guardar</button>
      </div>
    </form>
  </div>
</div>

<!-- Confirmación Eliminación -->
<div id="modalConfirm" class="modal">
  <div class="card" style="max-width:480px; width:95%; background:#fff; border-radius:12px; padding:16px; margin:0;">
    <h3 style="margin-top:0;">Confirmar eliminación</h3>
    <p>¿Seguro que querés eliminar este turno?</p>
    <div style="display:flex; gap:8px; justify-content:flex-end;">
      <button id="btnNo" class="btn btn-regresar">Cancelar</button>
      <button id="btnSi" class="btn btn-eliminar">Eliminar</button>
    </div>
  </div>
</div>

<!-- Toast global -->
<div id="toast" style="display:none;"></div>

<script src="{% static 'JS/turnos/spa.js' %}"></script>
{% endblock %}
