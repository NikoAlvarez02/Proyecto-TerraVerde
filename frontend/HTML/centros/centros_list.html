{% extends "base.html" %}
{% load static %}

{% block title %}Centros | TerraVerde{% endblock %}
{% block topbar_title %}Centros{% endblock %}
{% block sidebar %}{% endblock %}

{% block content %}
  <div class="card" style="padding:20px;">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <h1 class="main-title" style="margin:0;">Centros</h1>
      <div style="display:flex; gap:8px;">
        <a href="/admin/centers/center/" class="btn">Abrir en Admin</a>
        <button id="btnNuevoCentro" class="btn btn-guardar">Nuevo Centro</button>
      </div>
    </div>

    <div style="display:flex; gap:8px; align-items:center; justify-content:flex-end; margin-top:10px;">
      <input id="c_q" type="search" placeholder="Buscar código / nombre / dirección" style="padding:6px 10px; min-width:260px;">
      <select id="c_activo" style="padding:6px 10px;">
        <option value="">Todos</option>
        <option value="true">Solo activos</option>
        <option value="false">Solo inactivos</option>
      </select>
      <select id="c_orden" style="padding:6px 10px;">
        <option value="nombre">Nombre A-Z</option>
        <option value="-nombre">Nombre Z-A</option>
        <option value="codigo">Código A-Z</option>
        <option value="-codigo">Código Z-A</option>
      </select>
      <button id="c_buscar" class="btn">Filtrar</button>
    </div>

    <div class="tabla-wrap" style="margin-top:12px;">
      <table class="tabla-listado" id="centros-table">
        <thead>
          <tr>
            <th>Código</th>
            <th>Nombre</th>
            <th>Dirección</th>
            <th>Activo</th>
            <th style="width:1%; white-space:nowrap;"></th>
          </tr>
        </thead>
        <tbody id="tbody">
          <tr><td colspan="5">Cargando...</td></tr>
        </tbody>
      </table>
    </div>

    <div id="flash" style="display:none;margin-top:10px;"></div>
  </div>

  <!-- Modal Crear/Editar Centro -->
  <div id="modalCentro" class="modal">
    <div class="modal-card card">
      <div style="display:flex;justify-content:space-between;align-items:center;" class="drag-handle">
        <h2 id="modalTitle" class="main-title" style="margin:0;">Nuevo Centro</h2>
        <button id="btnCerrarCentro" class="btn btn-secundario">Cerrar</button>
      </div>
      <form id="formCentro" class="grid-2" style="margin-top:12px;">
        {% csrf_token %}
        <input type="hidden" id="c_id">

        <div>
          <label>Código</label>
          <input type="text" id="c_codigo" required>
        </div>
        <div>
          <label>Nombre</label>
          <input type="text" id="c_nombre" required>
        </div>
        <div class="col-span-2">
          <label>Dirección</label>
          <input type="text" id="c_direccion" required>
        </div>
        <div>
          <label>Teléfono</label>
          <input type="text" id="c_telefono">
        </div>
        <div>
          <label>Email</label>
          <input type="email" id="c_email">
        </div>
        <div class="col-span-2">
          <label style="display:flex; align-items:center; gap:8px;">
            <input type="checkbox" id="c_activo_chk" checked> Activo
          </label>
        </div>

        <div class="col-span-2" style="display:flex; gap:8px; justify-content:flex-end;">
          <button type="button" id="btnCancelarCentro" class="btn btn-cancelar-edit">Cancelar</button>
          <button type="submit" class="btn btn-guardar">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Confirmación Eliminación -->
  <div id="modalConfirm" class="modal">
    <div class="card" style="max-width:480px; width:95%; margin:40px auto; background:#fff; border-radius:12px; padding:16px;">
      <h3 style="margin-top:0;">Confirmar eliminación</h3>
      <p>¿Seguro que querés eliminar este centro?</p>
      <div style="display:flex; gap:8px; justify-content:flex-end;">
        <button id="btnNo" class="btn btn-regresar">Cancelar</button>
        <button id="btnSi" class="btn btn-eliminar">Eliminar</button>
      </div>
    </div>
  </div>

  {% block extra_js %}
  <script src="{% static 'JS/centros/spa.js' %}"></script>
  {% endblock %}
{% endblock %}
