{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{% static 'ASSETS/terraverde.ico' %}">
    <title>TerraVerde - Centro Psicopedag√≥gico</title>
    <link rel="stylesheet" href="{% static 'CSS/dashboard_styles.css' %}">
</head>
<style>
    
</style>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <div class="logo">
                    <div class="logo-icon">
                        <img src="{% static 'ASSETS/logo_trifusion.png' %}" alt="TerraVerde">
                    </div>
                    <h1>TerraVerde</h1>
                </div>
                <div class="quick-links">
                    {% if request.user.is_authenticated and request.user.perfil and request.user.perfil.puede_ver_calendario %}
                    <a class="qlink" href="{% url 'turnos:list' %}">Turnos</a>
                    {% endif %}
                    {% if request.user.is_authenticated and request.user.perfil and request.user.perfil.puede_ver_pacientes %}
                    <a class="qlink" href="{% url 'pacientes:list' %}">Pacientes</a>
                    {% endif %}
                    <a class="qlink" href="{% url 'profesionales:list' %}">Profesionales</a>
                    {% if request.user.is_authenticated and request.user.perfil and request.user.perfil.puede_ver_historias %}
                    <a class="qlink" href="{% url 'historias:historia' %}">Historias</a>
                    {% endif %}
                    {% if request.user.is_authenticated and request.user.perfil %}
                        {% if request.user.perfil.puede_generar_reportes or request.user.perfil.puede_ver_estadisticas %}
                        <a class="qlink" href="{% url 'reportes:dashboard' %}">Reportes</a>
                        {% endif %}
                    {% endif %}
                    {% if request.user.is_authenticated and request.user.perfil and request.user.perfil.puede_ver_estadisticas %}
                    <a class="qlink" href="{% url 'satisfaccion:list' %}">Satisfacci√≥n</a>
                    {% endif %}
                    {% if request.user.is_authenticated and request.user.perfil and request.user.perfil.rol == 'admin' %}
                    <a class="qlink" href="{% url 'admin_mod' %}">Admin</a>
                    {% endif %}
                </div>
            </div>
            <div class="user-info">
                <span style="color: #666;">Bienvenido, <strong>{{ request.user.first_name|default:request.user.username }}</strong></span>
                <div class="avatar">{{ request.user.first_name|default:request.user.username|slice:":1"|upper }}</div>
                <form method="post" action="{% url 'logout' %}" class="logout-form">
                    {% csrf_token %}
                    <button type="submit">Cerrar sesi√≥n</button>
                </form>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Pacientes Activos</span>
                    <div class="card-icon icon-purple">üë•</div>
                </div>
                <div class="stat-number">{{ pacientes_activos }}</div>
                <div class="stat-label">Activos en sistema</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%;"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Sesiones Hoy</span>
                    <div class="card-icon icon-pink">üìÖ</div>
                </div>
                <div class="stat-number">{{ sesiones_hoy_total }}</div>
                <div class="stat-label">{{ sesiones_hoy_completadas }} completadas, {{ sesiones_hoy_pendientes }} pendientes</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ sesiones_hoy_pct }}%;"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Tasa de Progreso</span>
                    <div class="card-icon icon-blue">üìä</div>
                </div>
                <div class="stat-number">{{ tasa_progreso }}%</div>
                <div class="stat-label">Promedio general</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ tasa_progreso }}%;"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Satisfacci√≥n</span>
                    <div class="card-icon icon-green">‚≠ê</div>
                </div>
                <div class="stat-number">{% if satisfaccion %}{{ satisfaccion }}{% else %}N/D{% endif %}</div>
                <div class="stat-label">De 5.0 estrellas</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ satisfaccion_pct }}%;"></div>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="card" style="grid-column: span 2;">
                <div class="card-header">
                    <span class="card-title">Pr√≥ximas Sesiones</span>
                    <span class="status-badge status-active">Hoy</span>
                </div>
                <ul class="session-list">
                    {% for t in proximas_sesiones %}
                    <li class="session-item">
                        <div>
                            <div class="session-time">{{ t.fecha_hora|date:"H:i" }}</div>
                            <div class="session-name">{{ t.motivo|default:"Sesi√≥n" }} - {{ t.paciente.apellido }}, {{ t.paciente.nombre }}</div>
                        </div>
                        <span class="status-badge {% if t.estado == 'pendiente' %}status-pending{% else %}status-active{% endif %}">{{ t.get_estado_display }}</span>
                    </li>
                    {% empty %}
                    <li class="session-item">
                        <div class="session-name">Sin pr√≥ximas sesiones hoy</div>
                    </li>
                    {% endfor %}
                </ul>
                <a href="{% url 'turnos:list' %}" class="btn btn-primary">Ver Calendario Completo</a>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Actividad Reciente</span>
                </div>
                <div class="activity-feed">
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <div class="activity-title">Nuevo paciente registrado</div>
                            <div class="activity-time">Hace 2 horas</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <div class="activity-title">Informe completado</div>
                            <div class="activity-time">Hace 5 horas</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <div class="activity-title">Sesi√≥n reagendada</div>
                            <div class="activity-time">Hace 1 d√≠a</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <span class="card-title">Estad√≠sticas Semanales</span>
            </div>
            <div class="chart-container">
                {% for d in weekly %}
                <div class="chart-bar" style="height: {{ d.pct }}%;">
                    <span class="chart-label">{{ d.label }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="notification" id="notification" {% if show_notification %}data-show="1"{% endif %}>
        <strong>üîî Pr√≥xima sesi√≥n</strong>
        <p style="margin-top: 8px; color: #666;">{% if notif_text %}{{ notif_text }}{% else %}Sin pr√≥ximas notificaciones{% endif %}</p>
    </div>

    <script>
        // Mostrar notificaci√≥n real si el backend lo indica
        (function(){
            const n = document.getElementById('notification');
            if (n && n.dataset.show === '1') {
                n.classList.add('show');
                setTimeout(() => n.classList.remove('show'), 6000);
            }
        })();

        // Animaci√≥n suave al hacer hover
        document.querySelectorAll('.card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px) scale(1.02)';
            });
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });
    </script>
</body>
</html>



