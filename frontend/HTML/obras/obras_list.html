{% extends "base.html" %}
{% load static %}

{% block title %}Obras Sociales | TerraVerde{% endblock %}
{% block topbar_title %}Obras Sociales{% endblock %}
{% block sidebar %}{% endblock %}

{% block content %}
  <div class="card" style="padding:20px;">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <h1 class="main-title" style="margin:0;">Obras Sociales</h1>
      <div style="display:flex; gap:8px;">
        <button id="btnNuevaObra" class="btn btn-guardar">Nueva Obra Social</button>
        <button id="btnImportar" class="btn">Importar desde SNRS</button>
        <input type="file" id="o_file" accept=".csv" style="display:none;" />
        <button id="btnImportarCSV" class="btn btn-secundario">Importar CSV</button>
      </div>
    </div>

    <div style="display:flex; gap:8px; align-items:center; justify-content:flex-end; margin-top:10px;">
      <input id="o_q" type="search" placeholder="Buscar nombre / código" style="padding:6px 10px; min-width:260px;">
      <select id="o_activo" style="padding:6px 10px;">
        <option value="">Todos</option>
        <option value="true">Solo activas</option>
        <option value="false">Solo inactivas</option>
      </select>
      <select id="o_orden" style="padding:6px 10px;">
        <option value="nombre">Nombre A-Z</option>
        <option value="-nombre">Nombre Z-A</option>
        <option value="codigo">Código A-Z</option>
        <option value="-codigo">Código Z-A</option>
      </select>
      <button id="o_buscar" class="btn">Filtrar</button>
    </div>

    <div class="tabla-wrap" style="margin-top:12px;">
      <table class="tabla-listado" id="obras-table">
        <thead>
          <tr>
            <th>Código</th>
            <th>Nombre</th>
            <th>Activo</th>
            <th style="width:1%; white-space:nowrap;"></th>
          </tr>
        </thead>
        <tbody id="o_tbody">
          <tr><td colspan="4">Cargando...</td></tr>
        </tbody>
      </table>
    </div>

    <div id="flash" style="display:none;margin-top:10px;"></div>
  </div>

  <!-- Modal Crear/Editar Obra Social -->
  <div id="modalObra" class="modal">
    <div class="card modal-card">
      <div class="modal-header drag-handle">
        <div class="title-wrap">
          <h2 id="o_modalTitle" class="main-title" style="color:#fff;">Nueva Obra Social</h2>
          <p>Gestiona las obras sociales disponibles.</p>
        </div>
        <button id="o_cerrar" class="modal-close" aria-label="Cerrar modal">✕</button>
      </div>
      <div class="modal-body">
        <form id="o_form" class="form-modal">
          {% csrf_token %}
          <input type="hidden" id="o_id">

          <div class="form-grid">
            <div>
              <label>Nombre</label>
              <input type="text" id="o_nombre" required>
            </div>
            <div>
              <label>Código</label>
              <input type="text" id="o_codigo">
            </div>
            <div>
              <label style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" id="o_activo_chk" checked> Activa
              </label>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <div class="footer-left"></div>
        <div class="footer-actions">
          <button type="button" id="o_cancelar" class="btn btn-secondary">Cancelar</button>
          <button type="submit" form="o_form" class="btn btn-success">Guardar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmación Eliminación -->
  <div id="o_modalConfirm" class="modal">
    <div class="card modal-card" style="max-width:520px;">
      <div class="modal-header">
        <div class="title-wrap">
          <h2 style="margin:0; color:#fff;">Confirmar eliminación</h2>
          <p>Esta acción no se puede deshacer.</p>
        </div>
        <button type="button" class="modal-close" aria-label="Cerrar" onclick="document.getElementById('o_no')?.click();">✕</button>
      </div>
      <div class="modal-body">
        <p>¿Seguro que querés eliminar esta obra social?</p>
      </div>
      <div class="modal-footer">
        <div class="footer-left">
          <button id="o_no" class="btn btn-secondary" type="button">Cancelar</button>
        </div>
        <div class="footer-actions">
          <button id="o_si" class="btn btn-danger">Eliminar</button>
        </div>
      </div>
    </div>
  </div>

  {% block extra_js %}
  <script src="{% static 'JS/obras/spa.js' %}"></script>
  {% endblock %}
{% endblock %}
