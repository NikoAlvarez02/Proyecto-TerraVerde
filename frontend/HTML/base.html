{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>{% block title %}Gesti贸n | TerraVerde{% endblock %}</title>

    <link rel="icon" type="image/x-icon" href="{% static 'ASSETS/favicon.ico' %}">
    <link rel="stylesheet" href="{% static 'CSS/styleturno.css' %}">
    {% block extra_css %}{% endblock %}
     
</head>
<body>
    <header class="topbar">
        <button class="menu-icon" aria-label="Abrir men煤">
            <img src="{% static 'ASSETS/logo.png' %}" alt="Men煤" width="26" height="26">
        </button>
        <a href="{% url 'home' %}" class="menu-icon" aria-label="Inicio" title="Inicio" style="margin-left:6px; display:inline-flex; align-items:center; justify-content:center;">
            <span style="font-size:18px;" aria-hidden="true"></span>
        </a>
        {% if request.user.is_authenticated and request.user.perfil and request.user.perfil.puede_ver_calendario %}
        <a href="{% url 'turnos:list' %}" class="menu-icon" aria-label="Turnos" title="Turnos" style="margin-left:6px; display:inline-flex; align-items:center; justify-content:center;">
            <span style="font-size:18px;" aria-hidden="true"></span>
        </a>
        {% endif %}
        {% if request.user.is_authenticated and request.user.perfil and request.user.perfil.puede_ver_pacientes %}
        <a href="{% url 'pacientes:list' %}" class="menu-icon" aria-label="Pacientes" title="Pacientes" style="margin-left:6px; display:inline-flex; align-items:center; justify-content:center;">
            <span style="font-size:18px;" aria-hidden="true"></span>
        </a>
        {% endif %}
        {% if request.user.is_authenticated and request.user.perfil %}
            {% if request.user.perfil.puede_generar_reportes or request.user.perfil.puede_ver_estadisticas %}
            <a href="{% url 'reportes:dashboard' %}" class="menu-icon" aria-label="Reportes" title="Reportes" style="margin-left:6px; display:inline-flex; align-items:center; justify-content:center;">
                <span style="font-size:18px;" aria-hidden="true"></span>
            </a>
            {% endif %}
        {% endif %}
        {% if request.user.is_authenticated and request.user.perfil and request.user.perfil.puede_ver_estadisticas %}
        <a href="{% url 'satisfaccion:list' %}" class="menu-icon" aria-label="Satisfacci贸n" title="Satisfacci贸n" style="margin-left:6px; display:inline-flex; align-items:center; justify-content:center;">
            <span style="font-size:18px;" aria-hidden="true"></span>
        </a>
        {% endif %}
        <h2 class="app-title">{% block topbar_title %}Gestionar Sistema{% endblock %}</h2>
        <form method="post" action="{% url 'logout' %}" class="logout-form">
            {% csrf_token %}
            <button type="submit" class="btn-logout">Cerrar Sesi贸n</button>
        </form>
    </header>

    <main class="main-wrap">
        <nav class="sidebar" id="sidebar">
            <h3>M贸dulos</h3>
            {% if request.user.is_authenticated and request.user.perfil and request.user.perfil.puede_ver_calendario %}<a href="{% url 'turnos:list' %}">Turnos</a>{% endif %}
            {% if request.user.is_authenticated and request.user.perfil and request.user.perfil.puede_ver_pacientes %}<a href="{% url 'pacientes:list' %}">Pacientes</a>{% endif %}
            <a href="{% url 'historias:historia' %}">Historias Cl铆nicas</a>

            <a href="{% url 'admin_mod' %}">Administraci贸n</a>
            <a href="{% url 'home' %}">Volver al Inicio</a>
        </nav>

        <section class="contenido-principal">
            {% block content %}
            {% endblock %}
        </section>
    </main>

    <footer class="site-footer">
        <p>漏2025 Centro Psicopedag贸gico. Todos los derechos reservados.</p>
    </footer>

    <script>
        const menuBtn = document.querySelector(".menu-icon");
        const sidebar = document.getElementById("sidebar");
        if (menuBtn && sidebar) {
            menuBtn.addEventListener("click", () => sidebar.classList.toggle("active"));
        }
    </script>

    <script src="{% static 'JS/csrf_fetch.js' %}"></script>
    {% block extra_js %}{% endblock %}

    <!-- Toast global reutilizable en todas las vistas -->
    <div id="toast" style="display:none;"></div>
    <script>
      window.showToast = function(msg, type, durationMs){
        try{
          var el = document.getElementById('toast');
          if(!el){ alert(msg); return; }
          var cls = (type === 'error') ? 'toast-error'
                   : (type === 'warning') ? 'toast-warning'
                   : (type === 'info') ? 'toast-info'
                   : 'toast-ok';
          el.className = cls;
          el.textContent = msg;
          el.style.display = 'block';
          clearTimeout(window.__toast_t);
          var t = typeof durationMs === 'number' ? durationMs : 3500;
          window.__toast_t = setTimeout(function(){ el.style.display='none'; }, t);
        }catch(e){ try{ alert(msg); }catch(_){} }
      };
      // Redefinir alert para usar toast por consistencia visual
      (function(){
        var _alert = window.alert;
        window.alert = function(msg){
          if (typeof window.showToast === 'function') { window.showToast(msg, 'error'); }
          else { _alert(msg); }
        };
      })();
    </script>

</body>
</html>
